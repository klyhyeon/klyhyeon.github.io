---
layout: post
title: 이벤트 스토밍
image: 
  path: /assets/img/blog/new_years_card_297_2023_a.jpg
#description: >
#  Version 9 is the most complete version of Hydejack yet.
#  Modernized design, big headlines, and big new features.
sitemap: false
---

Kafka를 활용한 이벤트 기반 아키텍처 구축 - 임준수 (딜리버리서비스팀), 송인태 (배차시스템팀)
{:.lead}

이벤트 기반 아키텍처를 적용했던 경험담을 공유 드립니다.
이벤트 정의부터 구현 과정 그리고 이후로 더 해볼 수 있는 것들까지, 우리가 고민했던 부분들을 이야기해보려 합니다.

- Table of Contents
{:toc .large-only}

### 이벤트 스토밍

- 이해관계자들의 용어를 통일한다
- 이를 싱크하기 위해 가지는 자리?

이벤트 스토밍 하는 이유?
- 유사한 용어가 혼용되어 사용되어서
- 도메인 요소의 흐름과 관계를 파악하지 못해서

근본 원인
- 사일로 내부에서만 전문가인 도메인 전문가
- 도메인에 거의 또는 전혀 관심이 없는 동료 개발자(정량적인 것에만 관심)

퍼즐 조각을 모으는데 엄청난 비용 발생


알베르토 브란돌리니가 제안 - 복잡한 비즈니스 도메인을 빠르게 탐색하고 학습할 수 있는 워크숍
코드를 없애고 모든 사람을 동일한 수준으로 만드는 접근법

## 워크숍 방법

- 회의실, 종이, 포스트잇(쉽게 떼고 붙일 수 있음), 실제 문제 해결에 관련된 모든 사람(질문이 있는 사람, 답이 있는 사람)
- 퍼실리테이터
  - 이해관계자가 아닌 분
  - 눈앞의 도메인에 대한 이해가 아니라 진행 상황 등을 파악해 워크숍이 원할하게 진행되도록 도와줌
  - 이벤트 스토밍과 도메인 이벤트가 뭔지 설명만 하고 바로 시작 
- 진행방법
  - 벽에 커다란 종이를 붙여 놓고 포스트잇을 붙여 나간다
  - 최대 4~5시간이 적당
- 도메인 이벤트
  - 도메인 전문가가 관심이 있는 어떤 사건(과거에 일어났던 일을 표현)
  - 이벤트가 발생한다는 것은 상태가 변경되었다는 것을 의미
  - 글을 조회 한다(이벤트일수도 아닐수도 있음)

1단계
- 각자가 알고있는 도메인 이벤트를 작성한다.
- 16명 팀이면 4~50분 동안 진행됨 (15분 휴식)
안티패턴(위원회)
- 포스트잇을 붙이기 전에 합의가 이루어지는 것
- 퍼실리테이터는 이를 꺠뜨려야한다.

2단계
- 모든 도메인 이벤트를 올바른 타임라인으로 정렬하고 실제로 중복되는 이벤트를 제거한다.
- 시간은 왼->오, 위->아래로 평행한 시간을 표현
드라이버와 네비게이터
- 드라이버(잘 알고 있거나 배워야 하는 사람이 좋음): 포스트잇 옮기는 사람
- 네비게이터: 지시 내리는 사람
안티패턴
- 스포츠카, 자율주행, 스포일러

3단계? 핫스폿
- 2단계에서 발생한 질문, 갈등, 불평, 불만 사항을 시각화하고 캡처함
- 당장 토론하지 않는다. 나중에 문제가 해결되면 제거
- 핫 스팟만 파악돼도 의미있는 워크샵이 됨

바운디드 컨텍스트
- 같은 용어라도 의미가 다르고 같은 대상이라도 지칭 용어가 다를 수 있다.
- 명백한 언어 불일치는 동일한 프로세스 내에서 여러 개의 바운디드 컨텍스트를 나태내는 지표임
- 커피 = 이탈리아 에스프레소/미국 아메리카노

커맨드 또는 액션
- 시스템에서 일어나는 일, 도메인 이벤트가 발생하는 원인

리드 모델 또는 정보
- 사용자가 결정을 내리는 데 필요한 정보
- 특정 정책으로 인해 발생한 도메인 이벤트의 결과가 리드 모델에 어떻게 반영되는지 확인할 수 있다.

정책
- ~할 때마다라는 단어로 시작
- 도메인 이벤트와 커멘드 사이에 위치
- 회원가입 - 웰컴 정책 - 웰컴킷 보내기

비즈니스 규칙(유효성 검사; 시스템이 일관성을 보장해야할 비즈니스 규칙)


